<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Cargar CSS -->
    <link rel="stylesheet" href="style.css" />
    <title>To-Do List</title>
  </head>
  <!-- OVERLAY QUE CUBRE TODA LA PANTALLA CUANDO NO HAY CONEXIÓN AL BACKEND -->
  <div
    id="offlineOverlay"
    role="alertdialog"
    aria-live="assertive"
    aria-modal="true"
    hidden
  >
    <div
      class="offline-card"
      role="document"
      aria-label="Conexión perdida"
      tabindex="0"
    >
      <div class="offline-spinner" aria-hidden="true"></div>
      <h3 class="offline-title">No se pudo conectar al servidor</h3>
      <div id="offlineMessage" class="offline-desc">
        Comprueba tu conexión o espera a que el servidor responda. Intentaré
        reconectar automáticamente.
      </div>
      <div class="offline-actions">
        <button id="btnRetry" class="btn-offline btn-retry" type="button" title="intento inmediato de reconexión">
          Reintentar ahora
        </button>
      </div>
    </div>
  </div>
  <body>
    <!-- Confirm modal -->
    <div
      id="confirmOverlay"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div
        class="modal-card"
        role="document"
        aria-labelledby="confirmTitle"
        tabindex="-1"
      >
        <h3 id="confirmTitle">Confirmar</h3>
        <div id="confirmBody" class="modal-body">¿Estás seguro?</div>
        <div class="modal-actions">
          <button id="confirmCancelBtn" class="btn-modal" type="button"  title="Cancelar la acción">
            Cancelar
          </button>
          <button id="confirmOkBtn" class="btn-modal primary" type="button"  title="Aceptar y ejecutar la acción">
            Confirmar
          </button>
        </div>
      </div>
    </div>

    <!-- Edit modal -->
    <div
      id="editOverlay"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div
        class="modal-card"
        role="document"
        aria-labelledby="editTitle"
        tabindex="-1"
      >
        <h3 id="editTitle">Editar descripción</h3>
        <div class="meta-row">Tarea: <span id="editTaskId">—</span></div>
        <textarea
          id="editTextarea"
          class="edit-text"
          aria-label="Descripción"
        ></textarea>
        <div class="modal-actions" style="margin-top: 8px">
          <button id="editCancel" class="btn-modal" type="button" title="Descartar cambios">
            Cancelar
          </button>
          <button id="editSave" class="btn-modal primary" type="button" title="Guardar cambios">
            Guardar
          </button>
        </div>
      </div>
    </div>
    <main class="app">
      <header class="header">
        <h1 class="title">To-Do List</h1>
        <div class="header-search">
          <input
            type="text"
            id="searchInputHeader"
            placeholder="Buscar por descripción..."
            aria-label="Buscar"
            title="Buscar tareas por descripción"
          />
        </div>
        <div class="counters">
          <button
            id="btnTheme"
            class="btn-theme"
            title="Cambiar entre modo claro y oscuro"
            type="button"
          >
            <svg
              id="iconTheme"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              stroke="currentColor"
              fill="none"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="4"></circle>
              <line x1="12" y1="2" x2="12" y2="5"></line>
              <line x1="12" y1="19" x2="12" y2="22"></line>
              <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"></line>
              <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"></line>
              <line x1="2" y1="12" x2="5" y2="12"></line>
              <line x1="19" y1="12" x2="22" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"></line>
              <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"></line>
            </svg>
          </button>

          <div id="total" class="counter" title="Cantidad total de tareas">Total: 0</div>
          <div id="pendientes" class="counter" title="Tareas sin completar">Pendientes: 0</div>
        </div>

        <button
          id="btnMenu"
          class="btn-menu"
          aria-label="Mostrar u ocultar menú"
          title="Abrir o cerrar el menú"
          type="button"
        >
          ☰
        </button>
      </header>

      <div class="app-body">
        <!-- =========================
     HTML (sidebar)
     ========================= -->
        <aside class="sidebar" id="appSidebar" aria-expanded="true" title="Menú lateral">
          <div>
            <div class="sidebar-header">
              <button
                id="btnExpandSidebar"
                class="btn-expand-sidebar"
                title="Expandir u ocultar el menú"
                aria-controls="sidebarContent"
                aria-expanded="true"
                type="button"
              >
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  class="hamburger-icon"
                  aria-hidden="true"
                  color="var(--text)"
                >
                  <line
                    class="line line1"
                    x1="3"
                    y1="6"
                    x2="21"
                    y2="6"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <line
                    class="line line2"
                    x1="3"
                    y1="12"
                    x2="21"
                    y2="12"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <line
                    class="line line3"
                    x1="3"
                    y1="18"
                    x2="21"
                    y2="18"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- CONTENIDO: envuelto en un nodo con id para aria-hidden -->
          <section
            class="controls-area"
            id="sidebarContent"
            role="region"
            aria-hidden="false"
            title="Opciones principales"
          >
            <!-- Sidebar counters -->
            <div class="sidebar-counters">
              <button
                id="btnThemeSidebar"
                class="btn-theme"
                title="Cambiar entre modo claro y oscuro"
                type="button"
              >
                <svg
                  id="iconTheme"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  fill="none"
                  stroke-width="2"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="4"></circle>
                  <line x1="12" y1="2" x2="12" y2="5"></line>
                  <line x1="12" y1="19" x2="12" y2="22"></line>
                  <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"></line>
                  <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"></line>
                  <line x1="2" y1="12" x2="5" y2="12"></line>
                  <line x1="19" y1="12" x2="22" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"></line>
                  <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"></line>
                </svg>
              </button>

              <div id="totalSidebar" class="counter" title="Total de tareas registradas">Total: 0</div>
              <div id="pendientesSidebar" class="counter" title="Tareas que aún no están completadas">Pendientes: 0</div>
            </div>

            <form id="formTarea" class="form" title="Crear una nueva tarea">
              <p>Crea una nueva tarea</p>
              <input
                type="text"
                id="descripcion"
                placeholder="Nueva tarea"
                aria-label="Nueva tarea"
                required
                title="Escribe la descripción de la tarea"
              />
              <p class="p">prioridad</p>
              <select id="prioridad" aria-label="Prioridad" title="Selecciona la prioridad de la tarea">
                <option value="Media" selected>Media</option>
                <option value="Alta">Alta</option>
                <option value="Baja">Baja</option>
              </select>
              <button type="submit" class="btn primary" title="Agregar tarea">Agregar</button>
            </form>

            <p class="p">Ajustes con selecciòn multiple</p>

            <div class="gestion" id="gestion-avanzada" title="Acciones para tareas seleccionadas">
              <!-- FILA 1: checkbox -->
              <div class="single-row">
                <label class="select-all" title="Seleccionar o deseleccionar todas las tareas">
                  <input type="checkbox" id="selectAll" />
                  <span class="label-text">Seleccionar todo</span>
                </label>
              </div>

              <!-- FILA 2: select prioridad -->
              <div
                class="single-row priority-inline"
                style="position: relative"
              >
                <!-- ICONO para modo colapsado -->
                <button
                  id="btnPrioridadIcon"
                  class="priority-icon-btn"
                  aria-label="Cambiar prioridad"
                  title="Cambiar prioridad de las tareas seleccionadas"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    fill="none"
                    stroke-width="2"
                  >
                    <path d="M4 6h12l-2 4 2 4H4z"></path>
                    <path d="M4 6v16"></path>
                  </svg>
                </button>

                <select id="selCambiarPrioridad" aria-label="Cambiar prioridad" title="Asignar una nueva prioridad a las tareas seleccionadas">
                  <option value="">-- Cambiar prioridad --</option>
                  <option value="Alta">Alta</option>
                  <option value="Media">Media</option>
                  <option value="Baja">Baja</option>
                </select>
              </div>

              <!-- FILA 3: marcar completadas / pendientes -->
              <div class="bulk-toggle btn-group">
                <button
                  id="btnMarcarSeleccionadas"
                  class="btn btn-primary"
                  type="button"
                  title="Marcar seleccionadas como completadas"
                >
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      d="M20 6L9 17l-5-5"
                      stroke="currentColor"
                      stroke-width="2"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label">completadas</span>
                </button>

                <button
                  id="btnMarcarPendientes"
                  class="btn btn-secondary"
                  type="button"
                  title="Marcar seleccionadas como pendientes"
                >
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <circle
                      cx="12"
                      cy="12"
                      r="8"
                      stroke="currentColor"
                      stroke-width="2"
                      fill="none"
                    />
                    <path
                      d="M12 8v4l2 2"
                      stroke="currentColor"
                      stroke-width="2"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label">Pendientes</span>
                </button>
              </div>

              <!-- FILA 4: eliminar / aplicar -->
              <div class="apply-delete btn-group">
                <button
                  id="btnEliminarSeleccionadas"
                  class="btn btn-danger"
                  type="button"
                  title="Eliminar tareas seleccionadas"
                >
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      d="M3 6h18M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6"
                      stroke="currentColor"
                      stroke-width="1.4"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label">Eliminar</span>
                </button>
                <button
                  id="btnAplicarPrioridad"
                  class="btn btn-ghost"
                  type="button"
                  title="Aplicar prioridad seleccionada"
                >
                  <svg
                    class="ico"
                    viewBox="0 0 24 24"
                    width="14"
                    height="14"
                    aria-hidden="true"
                  >
                    <path
                      d="M5 12h14M12 5l7 7-7 7"
                      stroke="currentColor"
                      stroke-width="1.5"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label" title="Aplicar cambios a tareas seleccionadas">Aplicar</span>
                </button>
              </div>

              <!-- Separador -->
              <div class="export-separator">Exportar Selección</div>

              <!-- FILA 5: export CSV / JSON -->
              <div class="export-actions btn-group">
                <button id="btnExportCSV" class="btn btn-ghost" type="button" title="Exportar selección como archivo CSV">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      d="M4 4h16v16H4z"
                      stroke="currentColor"
                      stroke-width="1.5"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4 9h16M4 15h16"
                      stroke="currentColor"
                      stroke-width="1.5"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label">CSV</span>
                </button>

                <button id="btnExportJSON" class="btn btn-ghost" type="button" title="Exportar selección como archivo JSON">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path
                      d="M6 4h12v16H6z"
                      stroke="currentColor"
                      stroke-width="1.5"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M9 8h6M9 12h6M9 16h6"
                      stroke="currentColor"
                      stroke-width="1.5"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="btn-label">JSON</span>
                </button>
              </div>
            </div>
          </section>
        </aside>

        <section class="content">
          <div class="content-card">
            <div class="bar">
              <h2
                style="margin: 0 0 12px 0; font-size: 16px; color: var(--text)"
              >
                Tareas
              </h2>
              <div class="search">
                <input
                  type="text"
                  id="searchInputMain"
                  placeholder="Buscar por descripción..."
                  aria-label="Buscar"
                  title="Filtrar tareas por texto"
                />
              </div>

              <div class="ordering" aria-label="Ordenar tareas" title="Opciones de ordenamiento">
                <label for="sortSelect" class="small-label">Ordenar</label>
                <select id="sortSelect" title="Ordenar tareas por categoría">
                  <option value="fecha">Fecha</option>
                  <option value="prioridad">Prioridad</option>
                  <option value="estado">Estado</option>
                  <option value="descripcion">Descripción</option>
                  <option value="hoy">Solo hoy</option>
                </select>

                <select id="orderSelect" title="Orden ascendente o descendente">
                  <option value="desc">Desc</option>
                  <option value="asc">Asc</option>
                </select>

                <!-- comentado para hacer peticiones automáticas al cambiar los select 
                <button id="btnOrdenar" class="btn">Aplicar</button>
                -->
              </div>

              <div class="view-switch" aria-label="Cambiar vista" title="Cambiar entre modo lista o miniaturas">
                <button
                  id="btnVistaLista"
                  class="btn"
                  title="Vista lista"
                  aria-pressed="true"
                  type="button"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    color="orange"
                  >
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                  </svg>
                </button>

                <button
                  id="btnVistaMini"
                  class="btn"
                  title="Vista miniaturas"
                  aria-pressed="false"
                  type="button"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    color="orange"
                  >
                    <rect x="4" y="4" width="6" height="6"></rect>
                    <rect x="14" y="4" width="6" height="6"></rect>
                    <rect x="4" y="14" width="6" height="6"></rect>
                    <rect x="14" y="14" width="6" height="6"></rect>
                  </svg>
                </button>
              </div>
            </div>

            <div
              id="emptyState"
              class="empty-state"
              style="
                display: none;
                padding: 18px;
                border-radius: 10px;
                border: 1px dashed #f2f2f2;
                color: var(--muted);
              "
            >
              <div>No hay tareas todavía</div>
              <div style="font-size: 13px; color: var(--muted)">
                Agrega tu primera tarea usando el campo en el sidebar.
              </div>
            </div>

            <div class="list-wrap">
              <ul id="listaTareas" class="task-grid" aria-live="polite"></ul>
            </div>
            <div class="pagination-wrapper">
              <div class="pagination-controls-wrapper">
                <div id="paginationControls" class="pagination-controls" title="Navegación de páginas"></div>
                <div class="pagination-settings">
                  <label class="small-label">Por página</label>
                  <select id="pageSizeSelect" title="Cantidad de tareas por página">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- contenedor para notificaciones -->
      <div
        id="notif-container"
        aria-live="polite"
        class="notif-container"
      ></div>
      <div id="overlay" class="overlay"></div>
    </main>

    <script src="script.js"></script>
  </body>
</html>
